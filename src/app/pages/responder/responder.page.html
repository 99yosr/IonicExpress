<ion-header [translucent]="false">
  <ion-toolbar>
    <ion-title>Responder Dashboard</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        <ion-icon slot="icon-only" name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="map-wrapper">
    <div #mapRef class="map-container"></div>
    
    <!-- Status Bar -->
    <div class="status-bar">
      <ion-item lines="none">
        <ion-icon name="location" slot="start"></ion-icon>
        <ion-label>
          <h3>Responder Status</h3>
          <p>{{ online ? 'Online - Accepting alerts' : 'Offline' }}</p>
        </ion-label>
        <ion-toggle 
          [checked]="online" 
          (ionChange)="toggleOnline($event)"
          aria-label="Online Status">
        </ion-toggle>
      </ion-item>
    </div>

    <!-- Mission Panel -->
    <div class="mission-panel" *ngIf="currentMission">
      <h2>Current Mission</h2>
      <ion-list>
        <ion-item>
          <ion-label>
            <h3>{{ currentMission.type }}</h3>
            <p>{{ currentMission.description }}</p>
            <p class="meta">
              Created: {{ currentMission.createdAt | date:'short' }}
              <span *ngIf="currentMission.numInjured != null">
                • Injured: {{ currentMission.numInjured }}
              </span>
            </p>
          </ion-label>
        </ion-item>
      </ion-list>
      
      <div class="mission-actions">
        <ion-button expand="block" color="primary" (click)="openInMaps()">
          <ion-icon name="navigate" slot="start"></ion-icon>
          Open in Maps
        </ion-button>
        <ion-button expand="block" color="success" (click)="openComplete()" [disabled]="missionBusy">
          <ion-icon name="checkmark" slot="start"></ion-icon>
          Complete Mission
        </ion-button>
        <ion-button expand="block" color="medium" (click)="cancelMission()" [disabled]="missionBusy">
          <ion-icon name="close" slot="start"></ion-icon>
          Cancel Mission
        </ion-button>
      </div>
    </div>

    <!-- Alerts Panel -->
    <div class="alerts-panel" *ngIf="!currentMission && alerts.length > 0">
      <h2>Nearby Alerts ({{ alerts.length }})</h2>
      <ion-list>
        <ion-item *ngFor="let alert of alerts">
          <ion-label>
            <h3>{{ alert.type }}</h3>
            <p>{{ alert.description }}</p>
            <p class="meta">
              Created: {{ alert.createdAt | date:'short' }}
              <span *ngIf="alert.numInjured != null">
                • Injured: {{ alert.numInjured }}
              </span>
            </p>
          </ion-label>
          <ion-button 
            slot="end" 
            fill="solid" 
            color="primary" 
            (click)="acceptAlert(alert)"
            [disabled]="acceptingId === alert._id">
            <ion-spinner *ngIf="acceptingId === alert._id"></ion-spinner>
            <span *ngIf="acceptingId !== alert._id">Accept</span>
          </ion-button>
        </ion-item>
      </ion-list>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!currentMission && !loadingAlerts && alerts.length === 0">
      <ion-icon name="notifications-off-outline"></ion-icon>
      <p>No alerts nearby</p>
    </div>

    <!-- Loading -->
    <div class="loading-overlay" *ngIf="loadingAlerts">
      <ion-spinner></ion-spinner>
    </div>
  </div>
</ion-content>