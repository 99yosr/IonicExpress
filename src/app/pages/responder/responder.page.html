<ion-header>
  <ion-toolbar>
    <ion-title>Responder</ion-title>
    <ion-buttons slot="end">
      <ion-button color="medium" (click)="logout()">Logout</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="map-wrapper">
    <div class="map-container" #mapRef></div>

    <div class="status-bar">
      <ion-item lines="none">
        <ion-icon name="pulse-outline" slot="start"></ion-icon>
        <ion-label>
          <h3>{{ online ? 'You are online' : 'You are offline' }}</h3>
          <p>
            {{ online ? 'Alerts update live while you stay connected.' : 'Toggle on when you are ready to help.' }}
          </p>
        </ion-label>
        <ion-toggle [checked]="online" (ionChange)="toggleOnline($event)"></ion-toggle>
      </ion-item>
    </div>

    @if (alerts.length) {
      <div class="alerts-panel">
        <h2>Active Alerts</h2>
        <ion-list lines="none">
          @for (alert of alerts; track alert._id) {
            <ion-item>
              <ion-label>
                <h3>{{ alert.type }}</h3>
                <p>{{ alert.description }}</p>
                <p class="meta">{{ alert.createdAt | date: 'short' }}</p>
                @if (alert.numInjured !== null && alert.numInjured !== undefined) {
                  <p class="meta">
                    Injured: {{ alert.numInjured }}
                  </p>
                }
              </ion-label>
              <ion-button
                slot="end"
                color="primary"
                fill="solid"
                size="small"
                [disabled]="acceptingId === alert._id || !online"
                (click)="acceptAlert(alert)"
              >
                @if (acceptingId === alert._id) {
                  <ion-spinner slot="start" name="crescent"></ion-spinner>
                }
                {{ acceptingId === alert._id ? 'Acceptingâ€¦' : 'Accept' }}
              </ion-button>
            </ion-item>
          }
        </ion-list>
      </div>
    }

    @if (!alerts.length && !loadingAlerts) {
      <div class="empty-state">
        <ion-icon name="notifications-off-outline"></ion-icon>
        <p>No alerts right now. Stay ready!</p>
      </div>
    }

    @if (loadingAlerts) {
      <div class="loading-overlay">
        <ion-spinner name="dots"></ion-spinner>
      </div>
    }
  </div>
</ion-content>
