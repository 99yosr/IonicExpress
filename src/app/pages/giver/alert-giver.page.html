<ion-header translucent="true">
  <ion-toolbar>
    <ion-title>Active Alerts</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()"><ion-icon slot="icon-only" name="log-out-outline"></ion-icon></ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content fullscreen>
  <ion-refresher slot="fixed" (ionRefresh)="refresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="map-wrapper">
    <div class="map-container" #mapRef></div>

    @if (loadingAlerts) {
      <div class="loading-overlay">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Loading alerts...</p>
      </div>
    }

    @if (alerts.length) {
      <div class="alerts-sheet">
        <div class="sheet-header">
          <h2>Alerts Nearby</h2>
          <ion-badge color="primary" class="alert-count">{{ alerts.length }}</ion-badge>
        </div>
        <ion-list lines="none" class="alerts-list">
          @for (alert of alerts; track alert._id) {
            <ion-item class="alert-item" [class.alert-item--accepted]="alert.status === 'accepted'">
              <div class="alert-indicator" [class]="'alert-indicator--' + alert.type"></div>
              <ion-label class="alert-content">
                <h3 class="alert-type">{{ alert.type | titlecase }}</h3>
                <p class="alert-description">{{ alert.description }}</p>
                <div class="alert-meta">
                  <ion-chip class="status-chip" [color]="getStatusColor(alert.status)">
                    <ion-icon name="time" class="chip-icon"></ion-icon>
                    <ion-label>{{ alert.status === 'accepted' ? 'Help on the way' : alert.status | titlecase }}</ion-label>
                  </ion-chip>
                  <span class="alert-time">{{ alert.createdAt | date: 'shortTime' }}</span>
                </div>
                @if (alert.numInjured && alert.numInjured > 0) {
                  <div class="injury-badge">
                    <ion-icon name="medkit-outline"></ion-icon>
                    <span>{{ alert.numInjured }} injured</span>
                  </div>
                }
              </ion-label>
              <ion-button
                class="action-button"
                fill="clear"
                size="small"
                (click)="viewAlertDetails(alert)"
              >
                <ion-icon name="chevron-forward" slot="icon-only"></ion-icon>
              </ion-button>
            </ion-item>
          }
        </ion-list>
      </div>
    } @else if (!loadingAlerts) {
      <div class="empty-state">
        <div class="empty-icon">
          <ion-icon name="notifications-off-outline"></ion-icon>
        </div>
        <h3>No Active Alerts</h3>
        <p>There are no alerts in your area right now.</p>
        <ion-button fill="outline" (click)="refresh()">
          <ion-icon name="refresh" slot="start"></ion-icon>
          Refresh
        </ion-button>
      </div>
    }
  </div>

  <ion-fab

    class="alerts-fab"
  >
    <ion-fab-button color="danger" (click)="launchAlert()" class="alert-fab-button">
      <ion-icon name="warning" class="fab-icon"></ion-icon>
      <span class="fab-label">Alert</span>
    </ion-fab-button>
  </ion-fab>

  
</ion-content>