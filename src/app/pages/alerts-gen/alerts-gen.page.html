<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Report Emergency</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form (ngSubmit)="submitAlert()">
    <ion-item>
      <ion-label position="stacked">Description</ion-label>
      <ion-textarea
        [value]="form().description"
        (ionInput)="onDescriptionInput($event)"
        placeholder="Describe what happened..."
        required
      ></ion-textarea>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Type</ion-label>
      <ion-select
        [value]="form().type"
        (ionChange)="onTypeChange($event)"
        required
      >
        <ion-select-option value="accident">Accident</ion-select-option>
        <ion-select-option value="fire">Fire</ion-select-option>
        <ion-select-option value="medical">Medical</ion-select-option>
        <ion-select-option value="crime">Crime</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Number of injured (optional)</ion-label>
      <ion-input
        type="number"
        [value]="form().numInjured"
        (ionInput)="onNumInjuredInput($event)"
      ></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Photo (optional)</ion-label>
      <div class="photo-actions">
        <ion-button type="button" fill="outline" expand="block" (click)="pickPhoto()" [disabled]="loading">
          Use camera or gallery
        </ion-button>
        <input
          type="file"
          accept="image/*"
          capture="environment"
          (change)="onFileChange($event)"
          [disabled]="loading"
        />
        <ion-text color="medium" *ngIf="form().file">{{ form().file?.name }}</ion-text>
      </div>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Location</ion-label>
      <ion-text>
        <p *ngIf="form().lat && form().lng">
          Lat: {{ form().lat | number: '1.5-5' }}, Lng: {{ form().lng | number: '1.5-5' }}
        </p>
        <p *ngIf="!form().lat">Fetching location...</p>
      </ion-text>
    </ion-item>

    <ion-button
      expand="block"
      type="submit"
      color="danger"
      [disabled]="loading || !form().lat"
    >
      {{ loading ? 'Sending...' : 'Send Alert' }}
    </ion-button>
  </form>

  <ion-text color="success" *ngIf="successMsg">{{ successMsg }}</ion-text>
  <ion-text color="danger" *ngIf="errorMsg">{{ errorMsg }}</ion-text>
</ion-content>
